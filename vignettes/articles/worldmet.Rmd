---
title: "Using {worldmet} to Locate, Import & Visualise Meteorological Data"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(worldmet)
```

# Importing Hourly Meteorological Data

## Show all sites

The function to use to find which sites are available is `import_ghcn_stations()`.

```{r getmeta}
import_ghcn_stations()
```

A better way to explore available stations is by using `return = "map"`, which shows each station on an interactive map. Click to expand the markers until you find the site of interest (shown by a blue marker), which can then be clicked for further information. The most important information revealed in the marker is the station ID, which is used to access the data.

```{r getmeta_map, out.width="100%"}
import_ghcn_stations(return = "map")
```

## Search based on latitude and longitude

Often, one has an idea of the region in which a site is of interest. For example, if the interest was in sites close to London, the latitude and longitude can be supplied and a search is carried out of the 10 nearest sites to that location. There is also an option n that can be used in change the number of nearest sites shown. If a lat/lng is provided, clicking on the blue marker will show the approximate distance between the site and the search coordinates.

```{r searchmeta, out.width="100%"}
import_ghcn_stations(lat = 51.5, lng = 0, return = "map")
```

## Importing Data

To obtain the data the user must supply a station ID and year(s) of interest. For example, to download data for Heathrow Airport in 2024 (ID `UKI0000EGLL`):

```{r import, eval=FALSE, echo=TRUE}
met_london <- import_ghcn_hourly("UKI0000EGLL", year = 2024)
head(met_london)
```

```{r importtrue, eval=TRUE, echo=FALSE}
load("met_london.RData")
head(met_london)
```

A wind rose (for example) can easily be plotted using `openair`:

```{r windrose}
# use function from openair
openair::windRose(met_london)
```

# Other Data Types

Also available in `worldmet` are:

- `import_ghcn_daily()`, which imports daily average data. Users may select specific stations, but all available years for that station will be downloaded.

- `import_ghcn_monthly_temp()`, which imports monthly average temperatures for the entire GHCN.

- `import_ghcn_monthly_precip()`, which imports monthly total precipitation for specific stations.

Outside of the GHCN, `worldmet` gives access to the historic Integrated Surface Database (ISD), with functions:

- `import_isd_stations()` to obtain metadata, and

- `import_isd_hourly()` and `import_isd_lite()` to obtain measurement data.

# Writing Data 

Two functions are made available for writing out the imported data for other uses.

- `write_met()` will write short-term data imported from the GHCN or ISD as individual files (either delimited, RDS, or parquet files) split by the year and monitoring station.

- `write_adms()` will write out (at present) ISD data in a format compatible with the Atmospheric Dispersion Modelling System (ADMS).

